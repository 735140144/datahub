<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="search" type="application/opensearchdescription+xml" title="DataHub" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600&display=swap"><title data-react-helmet="true">Spark | DataHub</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://datahubproject.io/docs/metadata-integration/java/spark-lineage"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Spark | DataHub"><meta data-react-helmet="true" name="description" content="To integrate Spark with DataHub, we provide a lightweight Java agent that listens for Spark application and job events and pushes metadata out to DataHub in real-time. The agent listens to events such application start/end, and SQLExecution start/end to create pipelines (i.e. DataJob) and tasks (i.e. DataFlow) in Datahub along with lineage to datasets that are being read from and written to. Read on to learn how to configure this for different Spark scenarios."><meta data-react-helmet="true" property="og:description" content="To integrate Spark with DataHub, we provide a lightweight Java agent that listens for Spark application and job events and pushes metadata out to DataHub in real-time. The agent listens to events such application start/end, and SQLExecution start/end to create pipelines (i.e. DataJob) and tasks (i.e. DataFlow) in Datahub along with lineage to datasets that are being read from and written to. Read on to learn how to configure this for different Spark scenarios."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://datahubproject.io/docs/metadata-integration/java/spark-lineage"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/metadata-integration/java/spark-lineage" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/metadata-integration/java/spark-lineage" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://RK0UG797F3-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.e92a45c1.css">
<link rel="preload" href="/assets/js/runtime~main.331aa834.js" as="script">
<link rel="preload" href="/assets/js/main.7e1fc825.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#090a11;color:#ffffff" role="banner"><div class="announcementBarContent_3EUC"><div><img src="/img/acryl-logo-white-mark.svg"><p><strong>Managed DataHub</strong><span> &nbsp;Acryl Data delivers an easy to consume DataHub platform for the enterprise</span></p></div> <a href="https://www.acryldata.io/datahub-beta" target="_blank" class="button button--primary">Sign up for Managed DataHub â†’</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/datahub-logo-color-light-horizontal.svg" alt="DataHub Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/datahub-logo-color-dark-horizontal.svg" alt="DataHub Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/docs/demo">Demo</a><a href="https://blog.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://feature-requests.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Feature Requests<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://feature-requests.datahubproject.io/roadmap" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Roadmap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link item__icon item__slack" aria-label="Slack"></a><a href="https://github.com/datahub-project/datahub" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link item__icon item__github" aria-label="GitHub"></a><a href="https://www.youtube.com/channel/UC3qFQC5IiwR5fvWEqi_tJ5w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link item__icon item__youtube" aria-label="YouTube"></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE" style="background-image:url(&quot;data:image/svg+xml,%3Csvg width=&#x27;18&#x27; height=&#x27;18&#x27; fill=&#x27;none&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cpath d=&#x27;M15.556 9.784A6.065 6.065 0 0 1 14 9.987a5.948 5.948 0 0 1-4.235-1.752 6.02 6.02 0 0 1-1.548-5.792.75.75 0 0 0-.918-.917A7.51 7.51 0 0 0 3.93 3.462c-2.924 2.924-2.924 7.682 0 10.607a7.453 7.453 0 0 0 5.304 2.198c2.003 0 3.886-.78 5.302-2.197a7.505 7.505 0 0 0 1.937-3.368.75.75 0 0 0-.918-.918Zm-2.079 3.225a5.96 5.96 0 0 1-4.242 1.758 5.964 5.964 0 0 1-4.243-1.758 6.009 6.009 0 0 1 0-8.486 5.942 5.942 0 0 1 1.545-1.112 7.52 7.52 0 0 0 2.167 5.886 7.479 7.479 0 0 0 5.886 2.168 6.026 6.026 0 0 1-1.113 1.544Z&#x27; fill=&#x27;%23fff&#x27; opacity=&#x27;.5&#x27;/%3E%3C/svg%3E&quot;);width:18px;height:18px;margin:-4px 0 0 -4px"> </span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE" style="background-image:url(&quot;data:image/svg+xml,%3Csvg width=&#x27;18&#x27; height=&#x27;18&#x27; fill=&#x27;none&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cg opacity=&#x27;.5&#x27; fill=&#x27;%23fff&#x27;%3E%3Cpath d=&#x27;M5.245 9A3.76 3.76 0 0 0 9 12.755 3.76 3.76 0 0 0 12.755 9 3.76 3.76 0 0 0 9 5.245 3.76 3.76 0 0 0 5.245 9ZM9 6.745A2.258 2.258 0 0 1 11.255 9 2.258 2.258 0 0 1 9 11.255 2.258 2.258 0 0 1 6.745 9 2.258 2.258 0 0 1 9 6.745Zm-.752 7.505h1.5v2.25h-1.5v-2.25Zm0-12.75h1.5v2.25h-1.5V1.5Zm-6.75 6.75h2.25v1.5h-2.25v-1.5Zm12.75 0h2.25v1.5h-2.25v-1.5ZM3.164 13.773l1.59-1.592 1.062 1.06-1.59 1.592-1.062-1.06ZM12.18 4.758l1.592-1.592 1.06 1.06-1.591 1.592-1.06-1.06ZM4.756 5.819l-1.59-1.592 1.06-1.06L5.818 4.76l-1.06 1.06ZM14.832 13.773l-1.06 1.06-1.592-1.591 1.06-1.06 1.592 1.59Z&#x27;/%3E%3C/g%3E%3C/svg%3E&quot;);width:18px;height:18px;margin:-4px 0 0 -4px"> </span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">DataHub</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authorization</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Ingestion</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata-ingestion">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Sources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata-ingestion/transformers">Transformers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Sinks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Scheduling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Push-Based Integrations</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Airflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/metadata-integration/java/spark-lineage">Spark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata-ingestion/integration_docs/great-expectations">Great Expectations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata-integration/java/datahub-protobuf">Protobuf Schemas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata-ingestion/as-a-library">Python Emitter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/metadata-integration/java/as-a-library">Java Emitter</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Lineage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Guides</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Modeling</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CLI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">GraphQL API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">OpenAPI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Actions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Usage Guides</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Guides</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment Guides</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Community</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spark</h1></header><p>To integrate Spark with DataHub, we provide a lightweight Java agent that listens for Spark application and job events and pushes metadata out to DataHub in real-time. The agent listens to events such application start/end, and SQLExecution start/end to create pipelines (i.e. DataJob) and tasks (i.e. DataFlow) in Datahub along with lineage to datasets that are being read from and written to. Read on to learn how to configure this for different Spark scenarios.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="configuring-spark-agent">Configuring Spark agent<a aria-hidden="true" class="hash-link" href="#configuring-spark-agent" title="Direct link to heading">â€‹</a></h2><p>The Spark agent can be configured using a config file or while creating a spark Session.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="before-you-begin-versions-and-release-notes">Before you begin: Versions and Release Notes<a aria-hidden="true" class="hash-link" href="#before-you-begin-versions-and-release-notes" title="Direct link to heading">â€‹</a></h2><p>Versioning of the jar artifact will follow the semantic versioning of the main <a href="https://github.com/datahub-project/datahub" target="_blank" rel="noopener noreferrer">DataHub repo</a> and release notes will be available <a href="https://github.com/datahub-project/datahub/releases" target="_blank" rel="noopener noreferrer">here</a>.
Always check <a href="https://search.maven.org/search?q=a:datahub-spark-lineage" target="_blank" rel="noopener noreferrer">the Maven central repository</a> for the latest released version.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="configuration-instructions-spark-submit">Configuration Instructions: spark-submit<a aria-hidden="true" class="hash-link" href="#configuration-instructions-spark-submit" title="Direct link to heading">â€‹</a></h3><p>When running jobs using spark-submit, the agent needs to be configured in the config file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#Configuring datahub spark agent jar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark.jars.packages                          io.acryl:datahub-spark-lineage:0.8.23</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark.extraListeners                         datahub.spark.DatahubSparkListener</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark.datahub.rest.server                    http://localhost:8080</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_31ik" id="configuration-for-amazon-emr">Configuration for Amazon EMR<a aria-hidden="true" class="hash-link" href="#configuration-for-amazon-emr" title="Direct link to heading">â€‹</a></h4><p>Set the following spark-defaults configuration properties as it stated <a href="https://docs.aws.amazon.com/emr/latest/ReleaseGuide/emr-spark-configure.html" target="_blank" rel="noopener noreferrer">here</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark.jars.packages        io.acryl:datahub-spark-lineage:0.8.23</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark.extraListeners                         datahub.spark.DatahubSparkListener</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark.datahub.rest.server                    https://your_datahub_host/gms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#If you have authentication set up then you also need to specify the Datahub access token</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark.datahub.rest.token                     yourtoken</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="configuration-instructions-notebooks">Configuration Instructions: Notebooks<a aria-hidden="true" class="hash-link" href="#configuration-instructions-notebooks" title="Direct link to heading">â€‹</a></h3><p>When running interactive jobs from a notebook, the listener can be configured while building the Spark Session.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SparkSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">builder \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">master</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark://spark-master:7077&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;test-application&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark.jars.packages&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;io.acryl:datahub-spark-lineage:0.8.23&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark.extraListeners&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;datahub.spark.DatahubSparkListener&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark.datahub.rest.server&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://localhost:8080&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">enableHiveSupport</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">getOrCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="configuration-instructions-standalone-java-applications">Configuration Instructions: Standalone Java Applications<a aria-hidden="true" class="hash-link" href="#configuration-instructions-standalone-java-applications" title="Direct link to heading">â€‹</a></h3><p>The configuration for standalone Java apps is very similar.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">spark = SparkSession.builder()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .appName(&quot;test-application&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .config(&quot;spark.master&quot;, &quot;spark://spark-master:7077&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .config(&quot;spark.jars.packages&quot;,&quot;io.acryl:datahub-spark-lineage:0.8.23&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .config(&quot;spark.extraListeners&quot;, &quot;datahub.spark.DatahubSparkListener&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .config(&quot;spark.datahub.rest.server&quot;, &quot;http://localhost:8080&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .enableHiveSupport()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .getOrCreate();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="configuration-details">Configuration details<a aria-hidden="true" class="hash-link" href="#configuration-details" title="Direct link to heading">â€‹</a></h3><table><thead><tr><th>Field</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>spark.jars.packages</td><td>âœ…</td><td></td><td>Set with latest/required version  io.acryl:datahub-spark-lineage:0.8.23</td></tr><tr><td>spark.extraListeners</td><td>âœ…</td><td></td><td>datahub.spark.DatahubSparkListener</td></tr><tr><td>spark.datahub.rest.server</td><td>âœ…</td><td></td><td>Datahub server url  eg:<a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a></td></tr><tr><td>spark.datahub.rest.token</td><td></td><td></td><td>Authentication token.</td></tr><tr><td>spark.datahub.rest.disable_ssl_verification</td><td></td><td>false</td><td>Disable SSL certificate validation. Caution: Only use this if you know what you are doing!</td></tr><tr><td>spark.datahub.metadata.pipeline.platformInstance</td><td></td><td></td><td>Pipeline level platform instance</td></tr><tr><td>spark.datahub.metadata.dataset.platformInstance</td><td></td><td></td><td>dataset level platform instance</td></tr><tr><td>spark.datahub.metadata.dataset.env</td><td></td><td>PROD</td><td><a href="/docs/graphql/enums#fabrictype">Supported values</a>. In all other cases, will fallback to PROD</td></tr><tr><td>spark.datahub.coalesce_jobs</td><td></td><td>false</td><td>Only one datajob(taask) will be emitted containing all input and output datasets for the spark application</td></tr><tr><td>spark.datahub.parent.datajob_urn</td><td></td><td></td><td>Specified dataset will be set as upstream dataset for datajob created. Effective only when spark.datahub.coalesce_jobs is set to true</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_31ik" id="what-to-expect-the-metadata-model">What to Expect: The Metadata Model<a aria-hidden="true" class="hash-link" href="#what-to-expect-the-metadata-model" title="Direct link to heading">â€‹</a></h2><p>As of current writing, the Spark agent produces metadata related to the Spark job, tasks and lineage edges to datasets.</p><ul><li>A pipeline is created per Spark &lt;master, appName&gt;.</li><li>A task is created per unique Spark query execution within an app.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="custom-properties--relating-to-spark-ui">Custom properties &amp; relating to Spark UI<a aria-hidden="true" class="hash-link" href="#custom-properties--relating-to-spark-ui" title="Direct link to heading">â€‹</a></h3><p>The following custom properties in pipelines and tasks relate to the Spark UI:</p><ul><li>appName and appId in a pipeline can be used to determine the Spark application</li><li>description and SQLQueryId in a task can be used to determine the Query Execution within the application on the SQL tab of Spark UI</li></ul><p>Other custom properties of pipelines and tasks capture the start and end times of execution etc.
The query plan is captured in the <em>queryPlan</em> property of a task.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="spark-versions-supported">Spark versions supported<a aria-hidden="true" class="hash-link" href="#spark-versions-supported" title="Direct link to heading">â€‹</a></h3><p>The primary version tested is Spark/Scala version 2.4.8/2_11.
This library has also been tested to work with Spark versions(2.2.0 - 2.4.8) and Scala versions(2.10 - 2.12).
For the Spark 3.x series, this has been tested to work with Spark 3.1.2 and 3.2.0 with Scala 2.12. Other combinations are not guaranteed to work currently.
Support for other Spark versions is planned in the very near future.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="environments-tested-with">Environments tested with<a aria-hidden="true" class="hash-link" href="#environments-tested-with" title="Direct link to heading">â€‹</a></h3><p>This initial release has been tested with the following environments:</p><ul><li>spark-submit of Python/Java applications to local and remote servers</li><li>Jupyter notebooks with pyspark code</li><li>Standalone Java applications</li></ul><p>Note that testing for other environments such as Databricks is planned in near future.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="spark-commands-supported">Spark commands supported<a aria-hidden="true" class="hash-link" href="#spark-commands-supported" title="Direct link to heading">â€‹</a></h3><p>Below is a list of Spark commands that are parsed currently:</p><ul><li>InsertIntoHadoopFsRelationCommand</li><li>SaveIntoDataSourceCommand (jdbc)</li><li>CreateHiveTableAsSelectCommand</li><li>InsertIntoHiveTable</li></ul><p>Effectively, these support data sources/sinks corresponding to Hive, HDFS and JDBC.</p><p>DataFrame.persist command is supported for below LeafExecNodes:</p><ul><li>FileSourceScanExec</li><li>HiveTableScanExec</li><li>RowDataSourceScanExec</li><li>InMemoryTableScanExec</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="spark-commands-not-yet-supported">Spark commands not yet supported<a aria-hidden="true" class="hash-link" href="#spark-commands-not-yet-supported" title="Direct link to heading">â€‹</a></h3><ul><li>View related commands</li><li>Cache commands and implications on lineage</li><li>RDD jobs</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="important-notes-on-usage">Important notes on usage<a aria-hidden="true" class="hash-link" href="#important-notes-on-usage" title="Direct link to heading">â€‹</a></h3><ul><li>It is advisable to ensure appName is used appropriately to ensure you can trace lineage from a pipeline back to your source code.</li><li>If multiple apps with the same appName run concurrently, dataset-lineage will be captured correctly but the custom-properties e.g. app-id, SQLQueryId would be unreliable. We expect this to be quite rare.</li><li>If spark execution fails, then an empty pipeline would still get created, but it may not have any tasks.</li><li>For HDFS sources, the folder (name) is regarded as the dataset (name) to align with typical storage of parquet/csv formats.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="debugging">Debugging<a aria-hidden="true" class="hash-link" href="#debugging" title="Direct link to heading">â€‹</a></h3><ul><li>Following info logs are generated</li></ul><p>On Spark context startup</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">YY/MM/DD HH:mm:ss INFO DatahubSparkListener: DatahubSparkListener initialised.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">YY/MM/DD HH:mm:ss INFO SparkContext: Registered listener datahub.spark.DatahubSparkListener</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>On application start</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">YY/MM/DD HH:mm:ss INFO DatahubSparkListener: Application started: SparkListenerApplicationStart(AppName,Some(local-1644489736794),1644489735772,user,None,None)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">YY/MM/DD HH:mm:ss INFO McpEmitter: REST Emitter Configuration: GMS url &lt;rest.server&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">YY/MM/DD HH:mm:ss INFO McpEmitter: REST Emitter Configuration: Token XXXXX</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>On pushing data to server</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">YY/MM/DD HH:mm:ss INFO McpEmitter: MetadataWriteResponse(success=true, responseContent={&quot;value&quot;:&quot;&lt;URN&gt;&quot;}, underlyingResponse=HTTP/1.1 200 OK [Date: day, DD month year HH:mm:ss GMT, Content-Type: application/json, X-RestLi-Protocol-Version: 2.0.0, Content-Length: 97, Server: Jetty(9.4.46.v20220331)] [Content-Length: 97,Chunked: false])</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>On application end</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">YY/MM/DD HH:mm:ss INFO DatahubSparkListener: Application ended : AppName AppID</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>To enable debugging logs, add below configuration in log4j.properties file</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">log4j.logger.datahub.spark=DEBUG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">log4j.logger.datahub.client.rest=DEBUG</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="known-limitations">Known limitations<a aria-hidden="true" class="hash-link" href="#known-limitations" title="Direct link to heading">â€‹</a></h2><ul><li>Only postgres supported for JDBC sources in this initial release. Support for other driver URL formats will be added in future.</li><li>Behavior with cached datasets is not fully specified/defined in context of lineage.</li><li>There is a possibility that very short-lived jobs that run within a few milliseconds may not be captured by the listener. This should not cause an issue for realistic Spark applications.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/datahub-project/datahub/blob/master/metadata-integration/java/spark-lineage/README.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/docker/airflow/local_airflow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Running Airflow locally with DataHub</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/metadata-ingestion/integration_docs/great-expectations"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Great Expectations<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuring-spark-agent" class="table-of-contents__link toc-highlight">Configuring Spark agent</a></li><li><a href="#before-you-begin-versions-and-release-notes" class="table-of-contents__link toc-highlight">Before you begin: Versions and Release Notes</a><ul><li><a href="#configuration-instructions-spark-submit" class="table-of-contents__link toc-highlight">Configuration Instructions: spark-submit</a></li><li><a href="#configuration-instructions-notebooks" class="table-of-contents__link toc-highlight">Configuration Instructions: Notebooks</a></li><li><a href="#configuration-instructions-standalone-java-applications" class="table-of-contents__link toc-highlight">Configuration Instructions: Standalone Java Applications</a></li><li><a href="#configuration-details" class="table-of-contents__link toc-highlight">Configuration details</a></li></ul></li><li><a href="#what-to-expect-the-metadata-model" class="table-of-contents__link toc-highlight">What to Expect: The Metadata Model</a><ul><li><a href="#custom-properties--relating-to-spark-ui" class="table-of-contents__link toc-highlight">Custom properties &amp; relating to Spark UI</a></li><li><a href="#spark-versions-supported" class="table-of-contents__link toc-highlight">Spark versions supported</a></li><li><a href="#environments-tested-with" class="table-of-contents__link toc-highlight">Environments tested with</a></li><li><a href="#spark-commands-supported" class="table-of-contents__link toc-highlight">Spark commands supported</a></li><li><a href="#spark-commands-not-yet-supported" class="table-of-contents__link toc-highlight">Spark commands not yet supported</a></li><li><a href="#important-notes-on-usage" class="table-of-contents__link toc-highlight">Important notes on usage</a></li><li><a href="#debugging" class="table-of-contents__link toc-highlight">Debugging</a></li></ul></li><li><a href="#known-limitations" class="table-of-contents__link toc-highlight">Known limitations</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/quickstart">Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features">Features</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC3qFQC5IiwR5fvWEqi_tJ5w" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/townhalls">Town Halls</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/#adoption">Adoption</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/demo">Demo</a></li><li class="footer__item"><a href="https://feature-requests.datahubproject.io/roadmap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Roadmap<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">Contributing</a></li><li class="footer__item"><a href="https://github.com/datahub-project/datahub" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://feature-requests.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Feature Requests<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2015-2022 DataHub Project Authors.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.331aa834.js"></script>
<script src="/assets/js/main.7e1fc825.js"></script>
</body>
</html>