"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[1790],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(a),h=r,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||o;return a?n.createElement(m,i(i({ref:t},p),{},{components:a})):n.createElement(m,i({ref:t},p))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<o;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},24127:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=a(83117),r=(a(67294),a(3905));const o={title:"Deleting Entities By Urn",slug:"/api/tutorials/deleting-entities-by-urn",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/deleting-entities-by-urn.md"},i="Deleting Entities By Urn",l={unversionedId:"docs/api/tutorials/deleting-entities-by-urn",id:"docs/api/tutorials/deleting-entities-by-urn",title:"Deleting Entities By Urn",description:"Why Would You Delete Entities?",source:"@site/genDocs/docs/api/tutorials/deleting-entities-by-urn.md",sourceDirName:"docs/api/tutorials",slug:"/api/tutorials/deleting-entities-by-urn",permalink:"/docs/api/tutorials/deleting-entities-by-urn",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/deleting-entities-by-urn.md",tags:[],version:"current",frontMatter:{title:"Deleting Entities By Urn",slug:"/api/tutorials/deleting-entities-by-urn",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/api/tutorials/deleting-entities-by-urn.md"},sidebar:"overviewSidebar",previous:{title:"Reading Domains From Datasets",permalink:"/docs/api/tutorials/removing-domains"},next:{title:"CLI",permalink:"/docs/cli"}},s={},d=[{value:"Why Would You Delete Entities?",id:"why-would-you-delete-entities",level:2},{value:"Goal Of This Guide",id:"goal-of-this-guide",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Delete Datasets With GraphQL",id:"delete-datasets-with-graphql",level:2},{value:"GraphQL Explorer",id:"graphql-explorer",level:3},{value:"CURL",id:"curl",level:3},{value:"Delete Datasets With Python SDK",id:"delete-datasets-with-python-sdk",level:2},{value:"Expected Outcomes",id:"expected-outcomes",level:2}],p={toc:d};function u(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"deleting-entities-by-urn"},"Deleting Entities By Urn"),(0,r.kt)("h2",{id:"why-would-you-delete-entities"},"Why Would You Delete Entities?"),(0,r.kt)("p",null,"You may want to delete a dataset if it is no longer needed, contains incorrect or sensitive information, or if it was created for testing purposes and is no longer necessary in production.\nIt is possible to ",(0,r.kt)("a",{parentName:"p",href:"/docs/how/delete-metadata"},"delete entities via CLI"),", but a programmatic approach is necessary for scalability."),(0,r.kt)("p",null,"There are two methods of deletion: soft delete and hard delete.\n",(0,r.kt)("strong",{parentName:"p"},"Soft delete")," sets the Status aspect of the entity to Removed, which hides the entity and all its aspects from being returned by the UI.\n",(0,r.kt)("strong",{parentName:"p"},"Hard delete")," physically deletes all rows for all aspects of the entity."),(0,r.kt)("p",null,"For more information about soft delete and hard delete, please refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/how/delete-metadata#delete-by-urn"},"Removing Metadata from DataHub"),"."),(0,r.kt)("h3",{id:"goal-of-this-guide"},"Goal Of This Guide"),(0,r.kt)("p",null,"This guide will show you how to delete a dataset named ",(0,r.kt)("inlineCode",{parentName:"p"},"fct_user_deleted"),".\nHowever, you can delete other entities like tags, terms, and owners with the same approach."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"For this tutorial, you need to deploy DataHub Quickstart and ingest sample data.\nFor detailed steps, please refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/quickstart"},"Datahub Quickstart Guide"),"."),(0,r.kt)("h2",{id:"delete-datasets-with-graphql"},"Delete Datasets With GraphQL"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\ud83d\udeab Hard delete with ",(0,r.kt)("inlineCode",{parentName:"p"},"graphql")," is currently not supported.\nPlease check out ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/datahub-apis#datahub-api-comparison"},"API feature comparison table")," for more information.")),(0,r.kt)("h3",{id:"graphql-explorer"},"GraphQL Explorer"),(0,r.kt)("p",null,"GraphQL Explorer is the fastest way to experiment with ",(0,r.kt)("inlineCode",{parentName:"p"},"graphql")," without any dependancies.\nNavigate to GraphQL Explorer (",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:9002/api/graphiql"),") and run the following query."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'mutation batchUpdateSoftDeleted {\n    batchUpdateSoftDeleted(input:\n      { urns: ["urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_deleted,PROD)"],\n        deleted: true })\n}\n')),(0,r.kt)("p",null,"If you see the following response, the operation was successful:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "batchUpdateSoftDeleted": true\n  },\n  "extensions": {}\n}\n')),(0,r.kt)("h3",{id:"curl"},"CURL"),(0,r.kt)("p",null,"With CURL, you need to provide tokens. To generate a token, please refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/api/graphql/token-management"},"Access Token Management"),".\nWith ",(0,r.kt)("inlineCode",{parentName:"p"},"accessToken"),", you can run the following command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"curl --location --request POST 'http://localhost:8080/api/graphql' \\\n--header 'Authorization: Bearer <my-access-token>' \\\n--header 'Content-Type: application/json' \\\n--data-raw '{ \"query\": \"mutation batchUpdateSoftDeleted { batchUpdateSoftDeleted(input: { deleted: true, urns: [\\\"urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_deleted,PROD)\\\"] }) }\", \"variables\":{}}'\n")),(0,r.kt)("p",null,"Expected Response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{ "data": { "batchUpdateSoftDeleted": true }, "extensions": {} }\n')),(0,r.kt)("h2",{id:"delete-datasets-with-python-sdk"},"Delete Datasets With Python SDK"),(0,r.kt)("p",null,"The following code deletes a hive dataset named ",(0,r.kt)("inlineCode",{parentName:"p"},"fct_users_deleted"),".\nYou can refer to the complete code in ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/datahub-project/datahub/blob/master/metadata-ingestion/examples/library/delete_dataset.py"},"delete_dataset.py"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import logging\nfrom datahub.cli import delete_cli\nfrom datahub.emitter.rest_emitter import DatahubRestEmitter\nfrom datahub.emitter.mce_builder import make_dataset_urn\n\nlog = logging.getLogger(__name__)\nlogging.basicConfig(level=logging.INFO)\n\nrest_emitter = DatahubRestEmitter(gms_server="http://localhost:8080")\ndataset_urn = make_dataset_urn(name="fct_users_created", platform="hive")\n\ndelete_cli._delete_one_urn(urn=dataset_urn, soft=true, cached_emitter=rest_emitter)\n\nlog.info(f"Deleted dataset {dataset_urn}")\n')),(0,r.kt)("p",null,"We're using the ",(0,r.kt)("inlineCode",{parentName:"p"},"MetdataChangeProposalWrapper")," to change entities in this example.\nFor more information about the ",(0,r.kt)("inlineCode",{parentName:"p"},"MetadataChangeProposal"),", please refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/advanced/mcp-mcl"},"MetadataChangeProposal & MetadataChangeLog Events")),(0,r.kt)("h2",{id:"expected-outcomes"},"Expected Outcomes"),(0,r.kt)("p",null,"The dataset ",(0,r.kt)("inlineCode",{parentName:"p"},"fct_users_deleted")," has now been deleted, so if you search for a hive dataset named ",(0,r.kt)("inlineCode",{parentName:"p"},"fct_users_delete"),", you will no longer be able to see it."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"dataset-deleted",src:a(21848).Z,width:"1055",height:"369"})))}u.isMDXComponent=!0},21848:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dataset-deleted-ad3bacd3e82134abb39ddfc54a69b13f.png"}}]);